<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="utf-8">
	<title>Andy Shora, Front-end Web Developer in London</title>
	<link rel="stylesheet" href="assets/css/main.css">
	<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet" type="text/css">
	<link rel="shortcut icon" href="/favicon.ico" />
	<meta name="description" content="Andy Shora, Front-end Web Developer in London">
	<meta name="author" content="Andy Shora">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

	<script src="assets/js/modernizr-min.js"></script>
	<!--[if lt IE 9]>
	<meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1">
	<script src="js/html5shiv.js" type="text/javascript"></script>
	<![endif]-->

	<script src="assets/js/jquery-1.9.1.min.js"></script>

	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<!--[if lt IE 7 ]><script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
	<script>window.attachEvent("onload",function(){CFInstall.check({mode:"overlay"})});</script><![endif]-->

</head>
<body>

<div id="body_wrap">

	<header class="page-header">
		<div class="page-header__title">
			<h1>Parallax effects in web design</h1>
			<p>Using CSS &amp; JavaScript to create parallax effects on scroll.</p>
		</div>
	</header>

	<div class="page-article">

		<section>
			<h2>How to implement parallax effects on scroll using JavaScript &amp; CSS</h2>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Praesentium autem ipsum deserunt. Ratione, ut, nihil, numquam molestiae placeat odit non voluptatum sed quos natus rem asperiores minima porro fugit praesentium quo omnis doloribus est accusantium officiis. Minus, iste labore recusandae consequatur sit sint dolore rem quisquam. Illum, architecto, maiores corrupti quos consectetur animi aperiam neque excepturi quis nihil vitae optio quas quam expedita blanditiis aliquam earum esse voluptatum necessitatibus dignissimos soluta eos minima provident officia voluptatem voluptas aut qui commodi recusandae culpa voluptatibus non saepe facere ipsam nemo totam eius ad amet dolorum incidunt quaerat tempore. Dolorem, commodi illo quis.</p>
			<h2>Performance Aims</h2>
			<ul>
				<li><strong>Minimise DOM interactions on scroll events.</strong><br>Ideally we should only be interacting with the parallax elements at the breakpoints (start &amp; stop positions), so we can try to make use of CSS fixed positioning to accomplish the desired parallax effect. Obviously if we're adding a speed to the effect later on, whereby the element moves at say double the speed of scroll, we're going to need to update the position on every scroll event.<br>Another important way of reducing the DOM interactions is to store all the static values from the parallax elements straight away when the page is loaded. The parallax settings defined in the HTML of each element will not change, so we would be sacrificing performance if we were grabbing these values on every scroll event.</li>
				<li><strong>For more complex animations, use hardware accelleration where possible.</strong><br>Mobile devices are less powerful, which can cause jerkyness when dealing with animations applied dynamically through JavaScript. When we get to dealing with the speed property, we'll look at using <i>transform</i> properties to enable supported mobile devices to use the more powerful GPU to perform the animations.</li>
				<li></li>
				<li></li>
			</ul>

		</section>

		<h4>Demo 1. Let's make the red brick fall down the page as we scroll.</h4>
		<p>We'll set bounds on the parallax effect, so the brick always stays within it's container.</p>
		<ul>
			<li>The CSS position value is shown inside the brick.</li>
			<li>For learning purposes, I've also shown the distance the viewport (the window) has been scrolled, and the distance of the element from the bottom of the viewport, as these values are used in the logic to start/stop/calculate the position of parallax elements.</li>
		</ul>
		<section class="demo parallax1">
			<div class="parallax ball" data-id="ball-1" data-start="200" data-stop="1152">
				<span class="content"></span>
				<div id="offset-bottom"></div>
				<div id="scroll-top"></div>
			</div>
			<!--<div class="parallax ball" data-id="ball-2" data-start="20" data-stop="1000" data-speed="1.1"></div>-->
		</section>

		<section>
			<h3>HTML markup for the parallax element</h3>
			<p>For this demo we are using a simple &lt;div&gt;, which has the following data attributes set which define the parallax effect (all values are in pixels):</p>
			<ul>
				<li><strong>data-start:</strong> The element will become fixed when the viewport bottom offset has reached this distance. You could change this to use the distance from the top, but personally I prefer it this way.</li>
				<li><strong>data-stop:</strong> When the viewport has been scrolled this distance, the parallax effect should end, leaving the element positioned relatively where it was at the end of the scroll. i.e. At the bottom of the container.</li>
				<li><strong>data-id:</strong> A unique id is used as a key in the <i>parallaxElements</i> array which holds these values on initialisation.</li>
			</ul>

<pre class="prettyprint lang-html">
&lt;div class="parallax ball" data-id="ball-1" data-start="200" data-stop="1152"&gt;&lt;/div&gt;
</pre>
<pre class="prettyprint lang-css">
.ball {
	width: 100px;
	height: 38px;
	padding: 10px 0 0 0;
	margin: 0 auto;
	display: inline-block;
	position: relative;
	top: 0;
	z-index: 1;
}
</pre>
<pre class="prettyprint lang-js">
var parallaxElements = [];
var windowHeight = 0;

$(document).ready(function() {

	windowHeight = $(window).height();
	$('html,body').scrollTop(0); // auto scroll to top

	$(window)
		.scroll(function(e) {
			parallax($(this).scrollTop());
		})
		.resize(function() {
			windowHeight = $(this).height(); // update on window resize
		});


	// get parallax elements straight away as they wont change
	// this will minimise DOM interactions on scroll events
	$('.parallax').each(function(){

		$elm = $(this);
		var id = $elm.data('id');

		// use data-id as key
		parallaxElements[id] = {
			id: $elm.data('id'),
			start: $elm.data('start'),
			stop: $elm.data('stop'),
			speed: $elm.data('speed'),
			elm: $elm[0],
			initialOffsetY: $elm.offset().top,
			height: $elm.height()
		};

	});
});
</pre>
<pre class="prettyprint lang-js">
function parallax(scrollTop) {

	for (var id in parallaxElements) {

		// distance of element from top of viewport
		var viewportOffsetTop = parallaxElements[id].initialOffsetY - scrollTop;

		// distance of element from bottom of viewport
		var viewportOffsetBottom = windowHeight - viewportOffsetTop;

		if ((viewportOffsetBottom >= parallaxElements[id].start) && (viewportOffsetBottom <= parallaxElements[id].stop)) {
			// element is now active, fix the position so when we scroll it stays fixed

			var speedMultiplier = parallaxElements[id].speed || 1;
			var pos = (windowHeight - parallaxElements[id].start);

			parallaxElements[id].elm.style.position = 'fixed';
			parallaxElements[id].elm.style.top = pos+'px';
			parallaxElements[id].elm.style.marginLeft = '-50px';

		} else if (viewportOffsetBottom > parallaxElements[id].stop) {
			// scrolled past the stop value, make position relative again

			parallaxElements[id].elm.style.position = 'relative';
			parallaxElements[id].elm.style.top = (parallaxElements[id].stop-parallaxElements[id].start)+'px';
			parallaxElements[id].elm.style.marginLeft = 0;

		} else if (viewportOffsetBottom < parallaxElements[id].start) {
			// scrolled up back past the start value, reset position

			parallaxElements[id].elm.style.position = 'relative';
			parallaxElements[id].elm.style.top = 0;
			parallaxElements[id].elm.style.marginLeft = 0;
		}

		$(parallaxElements[id].elm).find('.content').html(parallaxElements[id].elm.style.position);
	}

}
</pre>
			<h3>Using RequestAnimationFrame to make animations smoother</h3>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Impedit, voluptatibus id eius repellat porro recusandae tempora voluptate quidem fuga maiores.</p>
			<h3>Handling the logic and setting breakpoints of a parallax animation</h3>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Impedit, voluptatibus id eius repellat porro recusandae tempora voluptate quidem fuga maiores.</p>
		</section>

		<section>
			<h2>Considerations</h2>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Praesentium, dolor, dolorem! Assumenda, aut laborum adipisci et quae obcaecati officiis numquam.</p>
			<h3>Responsive Design</h3>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Tempora debitis repellendus in vel odit totam unde placeat necessitatibus quibusdam enim.</p>
			<h3>Performance</h3>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quod, et!</p>
			<h3>Old Browsers &amp; Slow Machines</h3>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Labore sapiente at explicabo iusto quaerat quam.</p>
		</section>

	</div>

</div>
<div class="author-wrap">
	<section class="author">
		<div class="author__pic"></div>
		<div class="author__desc">
			<p>Hi, I'm <strong>Andy Shora</strong>. I'm a <strong>Frontend Web Developer</strong> based in London and I currently work with some very talented people over at <a href="http://www.rga.com">R/GA</a>.</p>
			<div class="author__links">
				<a class="author__link" href="http://twitter.com/andyshora"><i class="icon-twitter"></i> @andyshora</a>
				<a class="author__link" href="http://www.facebook.com/andyshora"><i class="icon-facebook"></i> fb<span class="link__extra">.com/andyshora</span></a>
				<a class="author__link" href="http://www.pinterest.com/andyshora"><i class="icon-pinterest"></i> pinterest<span class="link__extra">.com/andyshora</span></a>
				<a class="author__link" href="http://www.github.com/andyshora"><i class="icon-github"></i> github<span class="link__extra">.com/andyshora</span></a>
				<a class="author__link" id="revealEmail()"><i class="icon-envelope"></i> contact<span class="link__extra"> me</span></a>
			</div>
		</div>
	</section>
</div>

<section class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

		var parallaxElements = [];
		var windowHeight = 0;

		$(document).ready(function() {

			windowHeight = $(window).height();
			$('html,body').scrollTop(0); // auto scroll to top

			$(window)
				.scroll(function(e) {
					parallax($(this).scrollTop());
				})
				.resize(function() {
					windowHeight = $(this).height(); // update on window resize
				});


			// get parallax elements straight away as they wont change
			// this will minimise DOM interactions on scroll events
			$('.parallax').each(function(){

				$elm = $(this);
				var id = $elm.data('id');

				// use data-id as key
				parallaxElements[id] = {
					id: $elm.data('id'),
					start: $elm.data('start'),
					stop: $elm.data('stop'),
					speed: $elm.data('speed'),
					elm: $elm[0],
					initialOffsetY: $elm.offset().top,
					height: $elm.height()
				};

			});
		});

		function parallax(scrollTop) {

			// update UI
			$('#scroll-top').html('scroll top: ' + scrollTop);

			for (var id in parallaxElements) {

				// distance of element from top of viewport
				var viewportOffsetTop = parallaxElements[id].initialOffsetY - scrollTop;

				// distance of element from bottom of viewport
				var viewportOffsetBottom = windowHeight - viewportOffsetTop;

				// update UI
				$('#offset-bottom').html('viewport bottom offset: ' + viewportOffsetBottom);

				if ((viewportOffsetBottom >= parallaxElements[id].start) && (viewportOffsetBottom <= parallaxElements[id].stop)) {
					// element is now active, fix the position so when we scroll it stays fixed

					var speedMultiplier = parallaxElements[id].speed || 1;
					var pos = (windowHeight - parallaxElements[id].start);

					parallaxElements[id].elm.style.position = 'fixed';
					parallaxElements[id].elm.style.top = pos+'px';
					parallaxElements[id].elm.style.marginLeft = '-50px';

				} else if (viewportOffsetBottom > parallaxElements[id].stop) {
					// scrolled past the stop value, make position relative again

					parallaxElements[id].elm.style.position = 'relative';
					parallaxElements[id].elm.style.top = (parallaxElements[id].stop-parallaxElements[id].start)+'px';
					parallaxElements[id].elm.style.marginLeft = 0;

				} else if (viewportOffsetBottom < parallaxElements[id].start) {
					// scrolled up back past the start value, reset position

					parallaxElements[id].elm.style.position = 'relative';
					parallaxElements[id].elm.style.top = 0;
					parallaxElements[id].elm.style.marginLeft = 0;
				}

				$(parallaxElements[id].elm).find('.content').html(parallaxElements[id].elm.style.position);
			}

		}
	</script>
	<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?lang=css&skin=sunburst"></script>
	<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		var disqus_shortname = 'andyshora'; // required: replace example with your forum shortname

		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function() {
			if ((window.location+'').match(/dev\./g)) return;
			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

<footer>
	<p>Andy Shora &copy; 2013</p>
</footer>
</body>
</html>
